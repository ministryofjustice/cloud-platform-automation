name: commit-check

on:
  pull request:

jobs:
  commit-check:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - id: commit-check
      name: commit-check
      uses: docker://minimum2scp/cloud-platform-commit-check:latest
      env: |
        - GITHUB_REPOSITORY_OWNER = ยง{{ github.repository_owner }}
        - GITHUB_REPOSITORY = ยง{{ github.repository }}
        - GITHUB_PR_NUMBER = ยง{{ github.event.number }}
        - FILE_NAME = "APPLY_PIPELINE_SKIP_THIS_NAMESPACE"
    
    - name: check commit result
      run: echo ${{ steps.commit-check.outputs.approval }}
    
    - name: auto-approve success
      if: ${{ steps.commit-check.outputs.approval == 'true' }}
      id: auto-approver-pullrequest
      uses: hmarr/auto-approve-action@v4
      with:
        github-token: ${{ secrets.pipeline_github_token }}
      
    - name: auto-approve failure
      if: ${{ steps.commit-check.outputs.approval == 'false' }}
      run: echo "This Pull Request can not be auto-approved."